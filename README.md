# cscore

#### 介绍
C语言程序在线打分核心逻辑。有些C语言题目在打印输出时会有格式说明符，题目将固定格式说明符对应的变量名。执行打分时，格式说明符对应的变量在输出时会有一个确定的值，我们将对学生提交的C语言代码和标准答案的输出进行格式说明符对应变量值的匹配，称其为动态的输出匹配。打印输出时非格式说明符部分称其为静态的输出，我们亦将对学生提交的C语言代码和标准答案的静态输出进行匹配。

#### 匹配逻辑
动态输出匹配：格式说明符决定格式说明符对应变量的值的输出格式，而格式说明符有很多，模板匹配格式说明符尽管有一定的可行性，但对于for循环，条件if、switch判断下的格式说明符的输出，区分不同的格式说明符以及运行时输出的个数是很困难的。代码采用“一劳永逸”的添加标记的方法，与其模板匹配格式说明符，不如模板匹配格式说明符前后的标记，对不同的格式说明符采用不同的标记，以此达到在运行时区分输出了某个格式说明符以及判断其个数的目的。我们将修改源C语言代码的过程称为编码的过程，从修改后的C语言代码的输出中还原出格式说明符对应的变量名以及对应的值的过程称为解码的过程。  

**编码**
定义格式说明符前后标记markedStart和markedEnd，定义替换格式说明符的标记replacedFormatSpecifier，替换格式说明符的标记以数组的形式进行区分。首先修改输入C语言程序代码，输出格式说明符前后加标记的.c文件(x.c)，输出注释格式说明符并在格式说明符前后加标记和去除格式说明符对应变量后的.c文件(y.c)，输出格式说明符前后加标记并替换格式说明符和去除格式说明符对应变量后的.c文件(z.c)。x.c输出类似于markedStart**value**markedEnd，y.c输出类似于markedStart**formatSpecifier**markedEnd，z.c的输出类似于markedStart**replacedFormatSpecifier**[**i**]markedEnd。  

**解码**
首先从源C语言代码中按照z.c的逻辑匹配格式说明符对应的变量和替换格式说明符的标记。接下来使用Java正则表达式匹配格式说明符前后的标记markedStart和markedEnd，对z.c的输出执行替换格式说明符的标记和格式说明符对应的变量名的匹配，添加进数组保存，对x.c和y.c的输出执行格式说明符对应的值的匹配(%3.5.d这种非法的格式说明符只会造成warning而不会编译执行报错，因此并不存在格式说明符对应的值和对应的变量，此种情况被排除)，添加进数组保存。根据格式说明符对应的变量和值的输出还原出以格式说明符对应的变量为key以格式说明符对应的值为value的json串。

#### 打分逻辑

**动态输出部分打分**  

根据格式说明符的json串，按照LCS算法进行打分，按照相同key的情况下value值完全相同或者标准答案为学生提交答案的父串的模式进行打分。(父串匹配的合理性取决于如%3d的输出与"空格"%2d的输出是一样的，但是格式说明符对应的值却是不一样的)。

**静态输出部分打分**  

只支持按行完全匹配或者按行LCS算法匹配。

#### 使用说明

修改格式说明符前后标记markedStart和markedEnd和替换格式说明符的标记replacedFormatSpecifier，学生提交的代码出现这三个标记的可能性几乎为0，重新编译jar包。
